{"componentChunkName":"component---src-templates-blog-post-js","path":"/angular-error/","result":{"data":{"site":{"siteMetadata":{"title":"What I Thought","description":"@keensyoのブログです。"}},"markdownRemark":{"id":"998fc2f8-626a-57cc-9872-9b8730ab50dc","excerpt":"Angular After Tutorialを始めようと思い、ng new したらエラーになった。 jasmine-core、karma-jasmine-html-reporter 辺りの依存関係が解決できないようだ。\n解消するために何をしたかメモ。 結論 node のバージョンを 14.16.…","html":"<p><a href=\"https://zenn.dev/lacolaco/books/angular-after-tutorial\">Angular After Tutorial</a>を始めようと思い、ng new したらエラーになった。</br></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> ERESOLVE unable to resolve dependency tree\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> While resolving: users@0.0.0\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> Found: jasmine-core@3.7.1\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> node_modules/jasmine-core\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>   dev jasmine-core@<span class=\"token string\">\"~3.7.0\"</span> from the root project\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> Could not resolve dependency:\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> peer jasmine-core@<span class=\"token string\">\">=3.8\"</span> from karma-jasmine-html-reporter@1.7.0\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> node_modules/karma-jasmine-html-reporter\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>   dev karma-jasmine-html-reporter@<span class=\"token string\">\"^1.5.0\"</span> from the root project\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> Fix the upstream dependency conflict, or retry\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> this <span class=\"token builtin class-name\">command</span> with --force, or --legacy-peer-deps\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> to accept an incorrect <span class=\"token punctuation\">(</span>and potentially broken<span class=\"token punctuation\">)</span> dependency resolution.\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> See /Users/kensyosakurai/.npm/eresolve-report.txt <span class=\"token keyword\">for</span> a full report.\n\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> A complete log of this run can be found in:\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>     /Users/kensyosakurai/.npm/_logs/2021-07-16T00_33_06_402Z-debug.log\n✖ Package <span class=\"token function\">install</span> failed, see above.\nThe Schematic workflow failed. See above.</code></pre></div>\n<p>jasmine-core、karma-jasmine-html-reporter 辺りの依存関係が解決できないようだ。</br>\n解消するために何をしたかメモ。</br></p>\n<h3>結論</h3>\n<p>node のバージョンを 14.16.1 に落として再実行。</p>\n<h3>やったこと</h3>\n<p>とりあえずググると試行錯誤された以下の記事が見つかった。</br>\n<a href=\"https://zenn.dev/hashito/articles/17239288bb63c5\">Angular@cli で ng new するとエラーになる</a></br>\nかなり細かく書いてもらっており、参考にさせてもらった。</br>\n自分の環境と照らし合わせて怪しそうな箇所だった<a href=\"https://zenn.dev/hashito/articles/17239288bb63c5#node.js%E7%92%B0%E5%A2%83%E3%81%8C2%E3%81%A4%E3%81%AF%E3%81%84%E3%81%A3%E3%81%A6%E3%81%84%E3%81%A6%E5%B9%B2%E6%B8%89%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%A7%E3%80%81%E7%89%87%E6%96%B9%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\">node.js 環境が 2 つはいっていて干渉しているので、片方を削除する</a>をまずは試した。</br>\n記事とは違い、自分の場合は nvm を残した。</br>\n深い意味はなく、nvm を使って node を管理しようとつい先日触っていたので nodebrew はいらないなという背景。</br>\n<a href=\"https://qiita.com/tonkotsuboy_com/items/f5d17f0b9698554a7716\">Nodebrew 本体を削除する方法</a>を参考に、PATH も削除。なぜか、~/.zprofile のほうに定義していた…</br></p>\n<p>当然これだけではうまくいかなかったので、zenn のほうで書かれていた node のバージョンを 14.16.1 に変更することを試した。</br></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nvm <span class=\"token function\">install</span> <span class=\"token number\">14.16</span>.1</code></pre></div>\n<p>実行後はこんな感じ。</br></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">nvm list\n-<span class=\"token operator\">></span>     v14.16.1\n       v14.17.1\n         system</code></pre></div>\n<p>この状態で ng new すると成功した。</br></p>\n<h3>なぜうまくいかなかったのか</h3>\n<p>zenn で言及されていた<a href=\"https://stackoverflow.com/questions/67433893/unable-to-resolve-dependency-tree-error-for-creating-new-angular-project/67451478#67451478\">stackoverflow</a>には npm7 系で node が最新だとうまくいかない issue があるよ、ということが書かれていたので探してみた。</br>\nすると、closed にはなっているものの<a href=\"https://github.com/angular/angular-cli/issues/21326\">同じこと</a>を挙げている人がいた。</br>\nangular team の人のコメントによると、karma-jasmine-html-reporter のリリースが起因していて、jasmine-core のバージョン 3.7 をサポートしていないことが原因らしい。</br>\nnpm7 系だと peer dependency の挙動が変わってしまっていると。</br>\nだから node を 14 系にすると、npm も 6 系になるから解消するということと理解した。</br>\nissue にワークアラウンドが書いてあるので、node 変えなくてもよかったかも。</br>\nでも、もともと 14.17.1 を入れていたから問題なさそうなのに…ちょっと謎が残る。</br></p>","frontmatter":{"title":"ng newするとkarma-jasmine-html-reporterのインストールに失敗する","date":"July 17, 2021"}},"previous":{"fields":{"slug":"/for-all-ordinary-person/"},"frontmatter":{"title":"会社員に向かない普通の人"}},"next":{"fields":{"slug":"/dbeaver-set-up/"},"frontmatter":{"title":"DBeaverでRailsのローカルDBを接続する"}}},"pageContext":{"id":"998fc2f8-626a-57cc-9872-9b8730ab50dc","previousPostId":"e456fed5-97ec-5b75-8d3a-0a06766a4453","nextPostId":"11e10820-0b30-5ab5-ad75-3ea42e71e569"}},"staticQueryHashes":["2841359383"]}